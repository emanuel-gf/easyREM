<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title> â€¢ easyREM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">easyREM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/easyREM.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1></h1>
            
      

      <div class="d-none name"><code>easyREM.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="relative-elevation-models">Relative Elevation Models<a class="anchor" aria-label="anchor" href="#relative-elevation-models"></a>
</h2>
<p>Relative Digital Models (REM) are a way to visualized and exposed
differences of elevation for a particular region of interest (ROI) and
highlight patterns that regarding land surface.</p>
<p>The REM are used as a methodology to delineating Planning-Level
Channel Migration Zones, propoused by Washignton State Department of
Ecology and regulate development within these areas on shoreline
streams.</p>
<p><a href="https://apps.ecology.wa.gov/publications/documents/1406025.pdf" class="external-link">CMZ
- Washington Ecology Dept.</a></p>
<p><a href="https://apps.ecology.wa.gov/publications/documents/1406025.pdf" class="external-link"><img src="Autors_WS_Ecology.png" alt="Channel Migration Zones and Modern Valley Bottom mapping. WS Dept of Ecology."></a></p>
<p>This notebook aims to help everyone interest in hydrology, water and
urban management.</p>
<div class="section level3">
<h3 id="libraries-and-dependencies">Libraries and dependencies<a class="anchor" aria-label="anchor" href="#libraries-and-dependencies"></a>
</h3>
<p>First we install the easyREM library hosted in github.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"emanuel-gf/easyREM"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emanuel-gf.github.io/easyREM/">easyREM</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-boundaries-bbox">Creating Boundaries (bbox)<a class="anchor" aria-label="anchor" href="#creating-boundaries-bbox"></a>
</h3>
<p>To delimitate the boundaries of the region of interest (ROI) I used
the ArcGIS web map to look at the USGS tiles and its covering regions
stored on the web-service.</p>
<p>The points represents the left-down and right-up corners of the
ROI.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Set boundaries of the bbox</span></span>
<span><span class="va">xmin</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">93.382</span></span>
<span><span class="va">ymin</span> <span class="op">&lt;-</span> <span class="fl">34.2653</span></span>
<span><span class="va">xmax</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">93.361</span></span>
<span><span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fl">34.275</span></span>
<span></span>
<span><span class="co">## Set CRS</span></span>
<span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fl">4326</span>  <span class="co">##WGS84</span></span>
<span></span>
<span><span class="co">### Creating the BBox</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_bbox.html">create_bbox</a></span><span class="op">(</span><span class="va">xmin</span>, <span class="va">xmax</span>, <span class="va">ymin</span>, <span class="va">ymax</span>,crs<span class="op">=</span><span class="va">crs</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Visualizing the bbox</span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu">mapview</span><span class="op">(</span><span class="va">bbox</span>,alpha<span class="op">=</span><span class="fl">0.1</span>,map.types <span class="op">=</span><span class="st">'Esri.WorldImagery'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dem-data">DEM Data<a class="anchor" aria-label="anchor" href="#dem-data"></a>
</h3>
<div class="section level4">
<h4 id="usgs-dem">USGS DEM<a class="anchor" aria-label="anchor" href="#usgs-dem"></a>
</h4>
<p>The USGS web-service provides an easy way to download its data
from</p>
<p>Download the files from the USGS service.</p>
<p>Depending the size of the ROI, it may take it a while.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://progressr.futureverse.org" class="external-link">progressr</a></span><span class="op">)</span></span>
<span><span class="fu">handlers</span><span class="op">(</span><span class="st">"progress"</span><span class="op">)</span></span>
<span><span class="fu">with_progress</span><span class="op">(</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">terrainr</span><span class="fu">::</span><span class="fu">get_tiles</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    output_prefix <span class="op">=</span> <span class="st">"rem"</span>,</span>
<span>    side_length <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    resolution <span class="op">=</span> <span class="fl">2</span>, <span class="co">#meters</span></span>
<span>    services <span class="op">=</span> <span class="st">"elevation"</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">'The DEM tiles are compose by %s tile(s)'</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dem</span><span class="op">$</span><span class="va">elevation</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>From USGS service, each tile has an size of 7948X7948, with a spatial
resolution of 1meter, returns a tile of nearly 8 km.</p>
<p>Sometimes, the ROI is covered by more than one tile, and it is
necessary to composite a mosaic of the tiles to deal it properly. To
properly mosaic, some attributes needs to be consider such as matching
the Spatial Resolution and CRS. The function deals with mosaicing
objects, the only variable to pass is a list that is provided from the
terrainR get_tiles function. In case you already have download the
tiles, you can easily recreate the list by running the following
code.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Converting to terra objects</span></span>
<span><span class="co">## In case the bbox have only one tile.</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dem</span><span class="op">$</span><span class="va">elevation</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dem_rast</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">dem</span><span class="op">$</span><span class="va">elevation</span><span class="op">)</span></span>
<span>  <span class="va">dem_rast</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"rem_3DEPElevation_1_1.tif"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co">## For more than one tile is necessary to create a composition</span></span>
<span>  <span class="va">dem_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_dem_tiles.html">process_dem_tiles</a></span><span class="op">(</span><span class="va">dem</span>,verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Deals with ROI bigger than only one tile. Be aware that big ROI areas
are not well representative for REM.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dem</span><span class="op">$</span><span class="va">elevation</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">### Merge the raster</span></span>
<span><span class="va">dem_mosaic</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dem_rast</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="va">dem_rast</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,<span class="va">dem_rast</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           <span class="va">dem_rast</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           <span class="co">#dem_rast[[5]],dem_rast[[6]],</span></span>
<span>                           filename<span class="op">=</span><span class="st">'merged.tif'</span>,</span>
<span>                           overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span> </span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="river-line">River Line<a class="anchor" aria-label="anchor" href="#river-line"></a>
</h3>
<p>In order to create REM objects, it is an important step to mapped the
center-line of river channels.</p>
<div class="section level4">
<h4 id="osm-data">OSM Data<a class="anchor" aria-label="anchor" href="#osm-data"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve OSM Data</span></span>
<span><span class="va">river</span> <span class="op">&lt;-</span> <span class="fu">osmdata</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/opq.html" class="external-link">opq</a></span><span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">osmdata</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/add_osm_feature.html" class="external-link">add_osm_feature</a></span><span class="op">(</span></span>
<span>        key <span class="op">=</span> <span class="st">"waterway"</span>,</span>
<span>        value <span class="op">=</span> <span class="st">"river"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">osmdata</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html" class="external-link">osmdata_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="co">##Simple feature objects </span></span>
<span></span>
<span><span class="va">river_sf</span> <span class="op">&lt;-</span> <span class="va">river</span><span class="op">$</span><span class="va">osm_lines</span> <span class="op">|&gt;</span> <span class="co">## Intersect the bbox</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span></span>
<span>        <span class="va">bbox</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span></span>
<span>        <span class="st">"LINESTRING"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Visualize the river shapefiles retrieved from OSM</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Visualize the river </span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem_rast</span><span class="op">)</span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span></span>
<span>        <span class="va">river_sf</span></span>
<span>    <span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="hydrosheed">HydroSheed<a class="anchor" aria-label="anchor" href="#hydrosheed"></a>
</h4>
<p>Another way to retrieve rivers shapefile is through the project
HydroSheeds <a href="https://www.hydrosheds.org/" class="external-link uri">https://www.hydrosheds.org/</a>. To facilitate the process,
the package contain a function that download it on your current folder
as a .shp file. The function requires a region that is sourced from the
HydroSheeds region mapping, where Global and regions Africa, South
America, Asia, Australia/Oceania, Europe, North America. More
information can be reached here: LINK TO THE EXPLATION PAGE IN GITHUB
LINK TO THE HYDROSHEEDS PROJECT</p>
<p>In order to figure out where our region of interest is located
regarding the atlas provided by HydroSheeds project, a function is
called to check it.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">determine_hydrosheds_region</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>,<span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>So, the correct HydroSheed Rivers dataset is downloaded</p>
<p>The glossay of HydroRivers are:</p>
<ul>
<li><p>sa = South America</p></li>
<li><p>ar = Artic</p></li>
<li><p>as = Asia</p></li>
<li><p>eu = Europe and Middle East</p></li>
<li><p>au = Australasia</p></li>
<li><p>na = North America</p></li>
<li><p>af = Africa</p></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rivers_ar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_hydrorivers.html">download_hydrorivers</a></span><span class="op">(</span><span class="st">"na"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rivers_ar</span><span class="op">)</span></span></code></pre></div>
<p>Filter only where the boundary box intersects the Rivers
geofiles.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rivers_intersect</span> <span class="op">&lt;-</span> <span class="fu">get_intersecting_rivers</span><span class="op">(</span><span class="va">rivers_ar</span>,<span class="va">bbox</span><span class="op">)</span></span></code></pre></div>
<p>Plot the WaterSheeds Rivers to compare with others Datasets.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem_rast</span><span class="op">)</span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span></span>
<span>        <span class="va">rivers_intersect</span></span>
<span>    <span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Due the fact the HydroSheeds project been generate by the USGS
DEM-30meters, the rivers are delineate by the accumulation flow and for
the flats areas the accumulation flow algoritm does not exactly matches
the center of a river line. To deal with the situation in the most
accuracy as possible, it is possible to create the river centerline with
several ways and approaches propoused by Remote Sensing imagery.</p>
<p>For the sense of propouse on this tutorial, we are gonna to attach at
the OSM data due the fact that it matches enough.</p>
</div>
</div>
<div class="section level3">
<h3 id="extract-values">Extract Values<a class="anchor" aria-label="anchor" href="#extract-values"></a>
</h3>
<p>Extracting elevation values is a strategy of populating the river
shapefile with elevation from the DEM raster. It is an crucial step to
develop the REM model.</p>
<p>Depending on your computational capacity, resampling the raster is
needed it. Also, with a resolution of 1 meter, for river changed capted
trhough each point was finer, less than 1 meter, and for the whole area
analysis is too computational expensive.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Resampling the raster in case your laptop can not process. </span></span>
<span><span class="co">#dem_rast_agg &lt;- terra::aggregate(</span></span>
<span><span class="co">#    dem_rast,</span></span>
<span><span class="co">#    fact = 2</span></span>
<span><span class="co">#)</span></span>
<span></span>
<span><span class="va">river_elev</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">dem_rast</span>,</span>
<span>    y <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">river_sf</span><span class="op">)</span>,</span>
<span>    xy <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">river_elev</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"elevation"</span> <span class="co">#Rename the column to elevation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">river_elev</span><span class="op">)</span>,<span class="st">'elevation points were extracted'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interpolation">Interpolation<a class="anchor" aria-label="anchor" href="#interpolation"></a>
</h3>
<div class="section level4">
<h4 id="idw---inverse-distance-weighting">IDW - Inverse Distance Weighting<a class="anchor" aria-label="anchor" href="#idw---inverse-distance-weighting"></a>
</h4>
<p>Inverse distance weighting is a spatial technique and well-spreaded
over the geospatial field. IDW takes into consideration that close
points are more weighted than relative far points. points that are
further away get less weight in predicting a value a location The IDW
for delineation of Bottom Valley Channel (BVC) was used by the
Washington Department of Ecology and its studies can be found it here:
<a href="https://apps.ecology.wa.gov/publications/documents/1406025.pdf" class="external-link uri">https://apps.ecology.wa.gov/publications/documents/1406025.pdf</a></p>
<p>In order to apply the method on R, the package gstat is called an
creates the IDW interpolation by the gstat object.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create IDW model</span></span>
<span><span class="va">idw_model</span> <span class="op">&lt;-</span> <span class="fu">gstat</span><span class="fu">::</span><span class="fu">gstat</span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">elevation</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  locations <span class="op">=</span> <span class="op">~</span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span>,</span>
<span>  data <span class="op">=</span> <span class="va">river_elev</span>,</span>
<span>  nmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">river_elev</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Predict Values by Interpolating </span></span>
<span><span class="va">river_surface</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/interpolate.html" class="external-link">interpolate</a></span><span class="op">(</span></span>
<span>  <span class="va">dem_rast</span>,</span>
<span>  <span class="va">idw_model</span>,</span>
<span>  crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">dem_rast</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="relative-elevation-model">Relative Elevation Model<a class="anchor" aria-label="anchor" href="#relative-elevation-model"></a>
</h3>
<p>The relative elevation model is nothing more than the subtraction of
the river interpolation raster by the digital elevation model.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">river_surface</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rem</span> <span class="op">&lt;-</span> <span class="va">dem_rast</span> <span class="op">-</span> <span class="va">river_surface</span></span>
<span></span>
<span><span class="va">rem_final</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/resample.html" class="external-link">resample</a></span><span class="op">(</span></span>
<span>    <span class="va">rem</span>, <span class="va">dem_rast</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualize">Visualize<a class="anchor" aria-label="anchor" href="#visualize"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rem_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">rem_final</span>,</span>
<span>    xy <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rem_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">rem_df</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"elevation"</span></span></code></pre></div>
<p>Computes logarithms from elevation</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fl">1e-10</span></span>
<span></span>
<span><span class="va">rem_df</span><span class="op">$</span><span class="va">elevation_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span></span>
<span>        <span class="va">rem_df</span><span class="op">$</span><span class="va">elevation</span>, <span class="va">epsilon</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu">classInt</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/classInt/reference/classIntervals.html" class="external-link">classIntervals</a></span><span class="op">(</span></span>
<span>    <span class="va">rem_df</span><span class="op">$</span><span class="va">elevation_log</span>,</span>
<span>    n <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    style <span class="op">=</span> <span class="st">"fisher"</span>,</span>
<span>    largeN<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>    samp_prop <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">brks</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Let`s make a quick plot to visualize the REM</span></span>
<span></span>
<span><span class="co">#Create a pallette </span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"vik"</span>,</span>
<span>    <span class="fl">12</span>, rev <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#Vis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/pie.html" class="external-link">pie</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span></span>
<span>    <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span></span>
<span><span class="op">)</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># SELECT THE PALLETTE</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="va">cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theme_for_the_win</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">theme</span><span class="op">(</span></span>
<span>            axis.line <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>            plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span></span>
<span>                fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="cn">NA</span></span>
<span>            <span class="op">)</span>,</span>
<span>            plot.margin <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                    t <span class="op">=</span> <span class="fl">0</span>, r <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                    l <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">0</span></span>
<span>                <span class="op">)</span>, <span class="st">"cm"</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">theme_for_vis</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">theme</span><span class="op">(</span></span>
<span>            axis.line <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            legend.position <span class="op">=</span> <span class="st">"right"</span>,  </span>
<span>            legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>            legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1.5</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>            legend.key.width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>            plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span></span>
<span>                fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="cn">NA</span></span>
<span>            <span class="op">)</span>,</span>
<span>            plot.margin <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                    t <span class="op">=</span> <span class="fl">0</span>, r <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                    l <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">0</span></span>
<span>                <span class="op">)</span>, <span class="st">"cm"</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rem_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span></span>
<span>                    <span class="va">rem_df</span>, <span class="fu">aes</span><span class="op">(</span></span>
<span>                    x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                    fill <span class="op">=</span> <span class="va">elevation_log</span></span>
<span>                    <span class="op">)</span></span>
<span>                  <span class="op">)</span><span class="op">+</span></span>
<span>                     <span class="fu">geom_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>                     <span class="fu">scale_fill_gradientn</span><span class="op">(</span></span>
<span>                         breaks <span class="op">=</span> <span class="va">breaks</span>,</span>
<span>                         colours <span class="op">=</span> <span class="va">pal</span>,</span>
<span>                         name <span class="op">=</span> <span class="st">""</span></span>
<span>                     <span class="op">)</span> <span class="op">+</span></span>
<span>                     <span class="fu">theme_for_the_win</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rem_plot</span></span></code></pre></div>
<p>Easily creating a contour line for the REM mode</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Contour Line</span></span>
<span><span class="va">contour_line</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="va">rem_final</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emanuel Goulart.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
